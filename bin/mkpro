#!/bin/bash

# mkpro : Create Qt project from commandline
# Usage mkpro <ProjectName> -c|-cpp|-i <directory>

PRO_NAME=${1/ /_}
PRO_TYPE=$2

if [ -z "$1" ]
then
    echo "Project name is required"
    exit 1
elsif [ -d "$1" ]
    echo "Project already exists"
    exit 1
else
    mkdir -p $PRO_NAME
    cd $PRO_NAME
fi

echo "TEMPLATE = app
CONFIG += console c++11
CONFIG -= app_bundle
CONFIG -= qt" > $PRO_NAME.pro

if [ "$2" == "-c" ]
then
    echo "#include <stdio.h>
#include <stdlib.h>

int main()
{
    // TODO
    return 0;
}
    " > main.c
    
    echo "SOURCES += main.c" >> $PRO_NAME.pro

elif [ "$2" == "-cpp" ]
then
    echo "#include <iostream>
#include <string>
#include <vector>

using namespace std;

int main()
{
    // TODO
    string s(\"Hello World\");
    cout << s << endl;
    return 0;
}
" > main.cpp
    
    echo "SOURCES += main.cpp" >> $PRO_NAME.pro
elif [ "$2" == "-i" ]
then
    PRO_TYPE="CUSTOM"
    PRO_IMPORT="$3"
    
    cp -f $PRO_IMPORT/*.c . 2> /dev/null
    cp -f $PRO_IMPORT/*.cpp . 2> /dev/null
    cp -f $PRO_IMPORT/*.h . 2> /dev/null
    cp -f $PRO_IMPORT/*.hpp . 2> /dev/null

    SOURCES=`ls *.c *.cpp 2> /dev/null | tr '\n' ' '`
    HEADERS=`ls *.h *.hpp 2> /dev/null | tr '\n' ' '`
    
    echo "SOURCES += $SOURCES
HEADERS += $HEADERS" >> $PRO_NAME.pro
fi
